---
title: "Home Ownership and Median Income"
output: github_document
---

# Load Libraries
```{r}
library(tidyverse)
library(ggplot2)
library(readr)
library(viridis)
```

# Import Data

```{r message=FALSE, warning=FALSE}
df <- read_csv('/Users/TyPainter1/Desktop/Masters/Fall\ 2020/DS-5610/eda20-team5-project/Data\ Basics/data.csv') 
```

# Clean Data

Most of the columns are hard to understand tried to make it easier
```{r}
df <- df %>% 
  mutate(ED_PRXECE_NM = exp(ED_PRXECE)) %>%
  mutate(ED_PRXHQECE_NM = exp(ED_PRXHQECE)) %>%
  mutate(HE_SUPRFND_NM = exp(HE_SUPRFND)) %>%
  mutate(HE_RSEI_NM = exp(HE_RSEI)) %>%
  select(-ED_PRXECE, -ED_PRXHQECE, -HE_SUPRFND, -HE_RSEI)
```

Most of the columns are hard to understand. We tried to make it easier and obvious even without the data dictionary.

```{r}
df <- df %>% 
  rename(id = `_id`) %>% 
  rename(geo_id = geoid) %>% 
  rename(metro_areas = in100) %>%
  rename(area_code = msaid15) %>% 
  rename(county_code = countyfips) %>%
  rename(num_under_18 = pop) %>% 
  rename(ratio_students_AP_enrolled = ED_APENR) %>%
  rename(perc_over24_college_degree = ED_ATTAIN) %>%
  rename(perc_18to24_nearby_college_enrolled = ED_COLLEGE) %>%
  rename(perc_3to4_school_enrolled = ED_ECENROL) %>%
  rename(perc_high_grad = ED_HSGRAD) %>%
  rename(score_third_grade_math = ED_MATH) %>%
  rename(score_third_grade_read = ED_READING) %>%
  rename(perc_elementary_school_poverty = ED_SCHPOV) %>% 
  rename(perc_teacher_1and2_years=ED_TEACHXP) %>% 
  rename(num_ECE_nearby = ED_PRXECE_NM) %>% 
  rename(num_high_qual_ECE_nearby = ED_PRXHQECE_NM) %>% 
  rename(perc_supermarket_nearby = HE_FOOD) %>% 
  rename(perc_green_space_access = HE_GREEN) %>%
  rename(days_temp_above90 = HE_HEAT) %>%
  rename(perc_0to64_health_insurance = HE_HLTHINS) %>%
  rename(mean_ozone_amount = HE_OZONE) %>%
  rename(mean_microparticle = HE_PM25) %>%
  rename(perc_housing_vacancy = HE_VACANCY) %>%
  rename(index_walkability = HE_WALK) %>% 
  rename(num_waste_dump_sites = HE_SUPRFND_NM) %>%
  rename(index_air_pollutants = HE_RSEI_NM) %>%
  rename(perc_below100_poverty = SE_POVRATE) %>%
  rename(perc_household_public_assistance = SE_PUBLIC) %>%
  rename(perc_home_ownership = SE_HOME) %>%
  rename(perc_over15_high_skill = SE_OCC) %>%
  rename(median_income=SE_MHE) %>%
  rename(perc_adults_employed = SE_EMPRAT) %>%
  rename(perc_worker_commute_over1hour = SE_JOBPROX) %>%
  rename(perc_single_parent = SE_SINGLE) 
usa_med_inc <- median(df$median_income, na.rm = TRUE)
```

# Create Data Frames 

```{r}
# Philly
philly <- df %>% 
  mutate(county_code = replace(county_code, county_code == '42017', 'Bucks')) %>%
  mutate(county_code = replace(county_code, county_code == '42029', 'Chester')) %>%
  mutate(county_code = replace(county_code, county_code == '42045', 'Delaware')) %>%
  mutate(county_code = replace(county_code, county_code == '42091', 'Montgomery')) %>%
  mutate(county_code = replace(county_code, county_code == '42101', 'Philadelphia')) %>% 
  mutate_all(~ifelse(is.na(.x), mean(.x, na.rm = TRUE), .x))
philly <- philly %>% filter(county_code %in% c('Bucks', 'Chester', 'Delaware', 'Montgomery', 'Philadelphia'))

philly$county_code = factor(philly$county_code, levels = c("Bucks", "Chester", "Delaware", "Montgomery", "Philadelphia"))

# NYC
nyc <- df %>%
  mutate(county_code = replace(county_code, county_code == '36061', 'Manhattan')) %>% 
  mutate(county_code = replace(county_code, county_code == '36047', 'Brooklyn')) %>%
  mutate(county_code = replace(county_code, county_code == '36081', 'Queens')) %>%
  mutate(county_code = replace(county_code, county_code == '36005', 'Bronx')) %>%
  mutate(county_code = replace(county_code, county_code == '36085', 'Staten Island'))%>%
  mutate_all(~ifelse(is.na(.x), mean(.x, na.rm = TRUE), .x))
nyc <- nyc %>% filter(county_code %in% c('Manhattan', 'Brooklyn', 'Queens', 'Bronx', 'Staten Island'))

nyc$county_code = factor(nyc$county_code, levels = c("Manhattan", "Brooklyn", "Queens", "Bronx", "Staten Island"))

# Houston
houston <- df %>% filter((county_code == "48201") | 
                           (county_code == "48157")| 
                           (county_code == "48339")|
                           (county_code == "48291")|
                           (county_code == "48473")) %>% 
  mutate(group = ifelse(county_code == "48201", "city", "suburb")) %>%
  mutate(county_name = case_when(county_code == "48201" ~ "Harris", 
                                 county_code == "48157" ~ "Fort Bend", 
                                 county_code == "48339" ~ "Montgomery", 
                                 county_code == "48291" ~ "Liberty", 
                                 county_code == "48473" ~ "Waller")) %>% 
  mutate_all(~ifelse(is.na(.x), mean(.x, na.rm = TRUE), .x))

houston$county_name = factor(houston$county_name, levels = c("Harris", "Fort Bend", "Montgomery", "Waller", "Liberty"))

# Los Angeles
la <- df %>%
  mutate(county_code = replace(county_code,county_code == "06111", "Ventura")) %>%
  mutate(county_code = replace(county_code, county_code == "06059","Orange"))%>%
  mutate(county_code = replace(county_code, county_code == "06071","San Bernardino"))%>%
  mutate(county_code = replace(county_code,county_code == "06037", "Los Angeles"))%>%
  mutate(county_code = replace(county_code,county_code == "06029", "Kern"))%>%
  mutate_all(~ifelse(is.na(.x), mean(.x, na.rm = TRUE), .x))
la <- la %>% filter(county_code %in% c("Ventura", "Orange", "San Bernardino", "Los Angeles", "Kern"))

la$county_code = factor(la$county_code, levels = c("Ventura", "Orange", "San Bernardino", "Los Angeles", "Kern"))
```

# Final Graphics 
## Philadelphia
```{r}
ggplot(philly, aes(x = reorder(county_code, median_income), y = median_income)) +
  geom_violin() +
  geom_point(position = position_jitter(width = 0.3), alpha = .3, aes(color = perc_home_ownership)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  scale_color_viridis(name = "Home Ownership",
                       labels = function(x){paste0(x, "%")})+
  scale_y_continuous(labels = function(x){paste0("$", x/1000, "K")},
                     breaks = seq(0,275000,50000)) +
  labs(x = "County",
       y = "Median Income",
       title = "Home Ownership in Philadelphia and Suburbs",
       subtitle = "vs. National Average") +
  geom_hline(yintercept = median(philly$median_income), color = "red", linetype = "dashed") +
  expand_limits(y = c(0,275000))
```

## New York City
```{r}
ggplot(nyc, aes(x = reorder(county_code, median_income), y = median_income)) +
  geom_violin() +
  geom_point(position = position_jitter(width = 0.4), alpha = .3, aes(color = perc_home_ownership)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  scale_color_viridis(name = "Home Ownership",
                       labels = function(x){paste0(x, "%")})+
  scale_y_continuous(labels = function(x){paste0("$", x/1000, "K")}, 
                     breaks = seq(0,275000,50000)) +
  labs(x = "County",
       y = "Median Income",
       title = "Home Ownership in NYC and Boroughs",
       subtitle = "vs. National Average") +
  geom_hline(yintercept = median(nyc$median_income), color = "red", linetype = "dashed") +
  expand_limits(y = c(0,275000))
```

## Houston
```{r}
ggplot(houston, aes(x = reorder(county_name, median_income), y = median_income)) +
  geom_violin() +
  geom_point(position = position_jitter(width = 0.4), alpha = .3, aes(color = perc_home_ownership)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  scale_color_viridis(name = "Home Ownership",
                       labels = function(x){paste0(x, "%")})+
  scale_y_continuous(labels = function(x){paste0("$", x/1000, "K")}, 
                     breaks = seq(0,275000,50000)) +
  labs(x = "County",
       y = "Median Income",
       title = "Home Ownership in Houston and Suburbs",
       subtitle = "vs. National Average") +
  geom_hline(yintercept = usa_med_inc, color = "red", linetype = "dashed") +
  expand_limits(y = c(0,275000))
```

## Los Angeles
```{r}
ggplot(la, aes(x = reorder(county_code, median_income), y = median_income)) +
  geom_violin() +
  geom_point(position = position_jitter(width = 0.4), alpha = .3, aes(color = perc_home_ownership)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  scale_color_viridis(name = "Home Ownership",
                       labels = function(x){paste0(x, "%")})+
  scale_y_continuous(labels = function(x){paste0("$", x/1000, "K")}, 
                     breaks = seq(0,275000,50000)) +
  labs(x = "County",
       y = "Median Income",
       title = "Home Ownership in Los Angeles and Suburbs",
       subtitle = "vs. National Average") +
  geom_hline(yintercept = usa_med_inc, color = "red", linetype = "dashed") +
  expand_limits(y = c(0,275000))
```